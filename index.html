<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conlang Studio Pro</title>
    <!-- External CSS files -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/tabs.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåê Conlang Studio Pro</h1>
            <p>Professional Constructed Language Creation Suite</p>
            
            <!-- Dark Mode Toggle Button -->
            <button class="dark-mode-toggle" id="dark-mode-toggle" title="Toggle dark mode">
                <span id="dark-mode-icon">üåô</span>
            </button>
        </div>

        <!-- Navigation tabs (generated by JavaScript) -->
        <div class="nav-tabs">
            <!-- Tabs will be inserted here by tab-manager.js -->
        </div>

        <!-- Tab content container -->
        <div id="tab-content-container" style="padding: 30px; min-height: 70vh;">
            <!-- Content will be loaded here by JavaScript -->
        </div>
    </div>

    <!-- Toast notification -->
    <div id="toast" class="toast"></div>

    <!-- Sample Language Selection Modal -->
    <div id="sample-modal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3>üìö Choose a Sample Language</h3>
                <button class="modal-close" onclick="closeSampleModal()">&times;</button>
            </div>
            <p style="margin-bottom: 20px; color: #666;">Select a cultural environment to generate a complete sample language with authentic phonology, grammar, and vocabulary:</p>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px;">
                <div class="sample-card" onclick="loadSampleLanguage('mountain')">
                    <h4>üèîÔ∏è Mountain Culture</h4>
                    <div class="sample-details">
                        <strong>Phonology:</strong> Harsh sounds, uvular consonants<br>
                        <strong>Grammar:</strong> SOV, complex case system<br>
                        <strong>Features:</strong> Elevation markers, clan hierarchy<br>
                        <strong>Generated:</strong> ~150 culturally appropriate words
                    </div>
                </div>
                
                <div class="sample-card" onclick="loadSampleLanguage('coastal')">
                    <h4>üåä Coastal Culture</h4>
                    <div class="sample-details">
                        <strong>Phonology:</strong> Flowing sounds, many liquids<br>
                        <strong>Grammar:</strong> VSO, tidal tense system<br>
                        <strong>Features:</strong> Directional markers, maritime vocab<br>
                        <strong>Generated:</strong> ~150 culturally appropriate words
                    </div>
                </div>
                
                <div class="sample-card" onclick="loadSampleLanguage('forest')">
                    <h4>üå≤ Forest Culture</h4>
                    <div class="sample-details">
                        <strong>Phonology:</strong> Soft sounds, nasals prominent<br>
                        <strong>Grammar:</strong> SOV, seasonal tense system<br>
                        <strong>Features:</strong> Growth aspects, canopy levels<br>
                        <strong>Generated:</strong> ~150 culturally appropriate words
                    </div>
                </div>
                
                <div class="sample-card" onclick="loadSampleLanguage('desert')">
                    <h4>üèúÔ∏è Desert Culture</h4>
                    <div class="sample-details">
                        <strong>Phonology:</strong> Pharyngeal sounds, ejectives<br>
                        <strong>Grammar:</strong> VOS, evidentiality system<br>
                        <strong>Features:</strong> Water marking, kinship focus<br>
                        <strong>Generated:</strong> ~150 culturally appropriate words
                    </div>
                </div>
                
                <div class="sample-card" onclick="loadSampleLanguage('plains')">
                    <h4>üåæ Plains Culture</h4>
                    <div class="sample-details">
                        <strong>Phonology:</strong> Open vowels, few consonant clusters<br>
                        <strong>Grammar:</strong> SVO, distance marking system<br>
                        <strong>Features:</strong> Directional system, herd counting<br>
                        <strong>Generated:</strong> ~150 culturally appropriate words
                    </div>
                </div>
                
                <div class="sample-card" onclick="loadSampleLanguage('arctic')">
                    <h4>‚ùÑÔ∏è Arctic Culture</h4>
                    <div class="sample-details">
                        <strong>Phonology:</strong> Minimal vowels, complex consonants<br>
                        <strong>Grammar:</strong> SOV, temperature marking<br>
                        <strong>Features:</strong> Ice terminology, survival focus<br>
                        <strong>Generated:</strong> ~150 culturally appropriate words
                    </div>
                </div>
                
                <div class="sample-card" onclick="loadSampleLanguage('island')">
                    <h4>üèùÔ∏è Island Culture</h4>
                    <div class="sample-details">
                        <strong>Phonology:</strong> Simple syllables, many vowels<br>
                        <strong>Grammar:</strong> VSO, wind direction system<br>
                        <strong>Features:</strong> Navigation terms, coral types<br>
                        <strong>Generated:</strong> ~150 culturally appropriate words
                    </div>
                </div>
                
                <div class="sample-card" onclick="loadSampleLanguage('urban')">
                    <h4>üèôÔ∏è Urban Culture</h4>
                    <div class="sample-details">
                        <strong>Phonology:</strong> Borrowed sounds, tone system<br>
                        <strong>Grammar:</strong> SVO, social status marking<br>
                        <strong>Features:</strong> Trade terminology, tech terms<br>
                        <strong>Generated:</strong> ~150 culturally appropriate words
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript files -->
    <script src="js/conlang-generator.js"></script>
    <script src="js/state-manager.js"></script>
    <script src="js/modules/phonology.js"></script>
    <script src="js/modules/grammar.js"></script>
    <script src="js/modules/morphology.js"></script>
    <script src="js/modules/generator.js"></script>
    <script src="js/modules/vocabulary.js"></script>
    <script src="js/modules/corpus.js"></script>
    <script src="js/modules/cultural.js"></script>
    <script src="js/modules/overview.js"></script>
    <script src="js/modules/export.js"></script>
    <script src="js/tab-manager.js"></script>
    
    <!-- Utility functions -->
    <script>
        // Dark Mode Toggle Functionality
        function initDarkMode() {
            const toggle = document.getElementById('dark-mode-toggle');
            const icon = document.getElementById('dark-mode-icon');
            const body = document.body;
            
            // Check for saved preference or default to light mode
            const savedTheme = localStorage.getItem('theme') || 'light';
            setTheme(savedTheme);
            
            toggle.addEventListener('click', () => {
                const currentTheme = body.getAttribute('data-theme') || 'light';
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                setTheme(newTheme);
                localStorage.setItem('theme', newTheme);
                
                // Add a little animation feedback
                toggle.style.transform = 'scale(0.9)';
                setTimeout(() => {
                    toggle.style.transform = 'scale(1)';
                }, 150);
            });
            
            function setTheme(theme) {
                body.setAttribute('data-theme', theme);
                icon.textContent = theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
                toggle.setAttribute('title', theme === 'light' ? 'Switch to dark mode' : 'Switch to light mode');
            }
        }

        // Toast function
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type === 'error' ? 'error' : ''}`;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('All modules loaded successfully!');
            
            // Initialize dark mode
            initDarkMode();
            
            // Update activity display on home tab
            if (window.ActivityModule) {
                window.ActivityModule.updateRecentActivityDisplay();
            }
        });

        // Sample language modal functions
        function showSampleModal() {
            document.getElementById('sample-modal').style.display = 'block';
        }

        function closeSampleModal() {
            document.getElementById('sample-modal').style.display = 'none';
        }

        // Load sample language with cultural preset
        // FIXED loadSampleLanguage function - Replace the entire script section in your index.html

        // Sample language modal functions
        function showSampleModal() {
            document.getElementById('sample-modal').style.display = 'block';
        }

        function closeSampleModal() {
            document.getElementById('sample-modal').style.display = 'none';
        }

        // Complete Preset System - SINGLE WORKING VERSION
        function loadSampleLanguage(culture) {
            const culturalPresets = {
                mountain: {
                    name: 'Mountain Culture',
                    emoji: 'üèîÔ∏è',
                    phonology: {
                        vowels: ['a', 'e', 'i', 'o', 'u'],
                        consonants: ['p', 't', 'k', 'q', 'b', 'd', 'g', 'm', 'n', '≈ã', 's', ' É', 'x', 'l', 'r', 'w', 'j'],
                        syllableStructures: ['CV', 'CVC', 'CVCC']
                    },
                    morphology: {
                        hasCases: true,
                        hasPlurals: true,
                        hasTenses: true,
                        hasGenders: false,
                        cases: ['nominative', 'accusative', 'genitive', 'locative', 'instrumental'],
                        tenses: ['past', 'present', 'future', 'perfect'],
                        pluralTypes: ['suffix'],
                        genders: []
                    },
                    syntax: { wordOrder: 'sov' },
                    customAffixes: [
                        { name: 'elevation-high', morpheme: 'khar', type: 'prefix', category: 'derivational', description: 'Marks things at high elevation' },
                        { name: 'elevation-low', morpheme: 'mor', type: 'prefix', category: 'derivational', description: 'Marks things at low elevation' },
                        { name: 'clan-marker', morpheme: 'eth', type: 'suffix', category: 'derivational', description: 'Indicates clan or family relationship' }
                    ],
                    culturalData: {
                        type: 'mountain',
                        environment: 'mountain',
                        socialStructure: 'tribal',
                        calendar: {
                            name: 'Peak-Shadow Calendar',
                            description: 'Based on mountain shadows and seasonal avalanche patterns',
                            timeConcept: 'cyclical with emphasis on seasonal mountain changes',
                            divisions: ['Snow-time', 'Melt-time', 'Growth-time', 'Harvest-time', 'Prepare-time'],
                            events: [
                                { name: 'Peak Blessing Festival', meaning: 'ceremony honoring the highest peaks and ancestors' },
                                { name: 'Avalanche Warning Ritual', meaning: 'ritual to predict and prevent avalanches' },
                                { name: 'Clan Gathering', meaning: 'annual meeting of all mountain clans' },
                                { name: 'Stone Carving Day', meaning: 'day for carving clan marks in sacred stones' }
                            ]
                        },
                        socialStructure: {
                            terms: [
                                { english: 'chief', meaning: 'peak leader', description: 'The highest ranking clan leader' },
                                { english: 'clan elder', meaning: 'clan wisdom keeper', description: 'Elderly clan member who keeps oral traditions' },
                                { english: 'peak guard', meaning: 'mountain guardian', description: 'Warrior responsible for protecting mountain passes' },
                                { english: 'stone speaker', meaning: 'stone interpreter', description: 'Shaman who reads omens in rock formations' },
                                { english: 'path finder', meaning: 'way seeker', description: 'Expert guide who knows all mountain paths' }
                            ]
                        },
                        traditions: {
                            life: [
                                { name: 'Peak Naming', description: 'Newborns are named after the peak visible from their birthplace' },
                                { name: 'First Summit', description: 'Youth must climb a sacred peak alone to become adults' }
                            ],
                            seasonal: [
                                { name: 'Snow Feast', description: 'Celebration of first snowfall with preserved foods' },
                                { name: 'Melt Water Blessing', description: 'Spring ceremony to bless the mountain streams' }
                            ],
                            social: [
                                { name: 'Stone Circle Decision', description: 'Democratic decisions made in sacred stone circles' },
                                { name: 'Peak Hospitality', description: 'Sacred duty to shelter travelers in mountain storms' }
                            ]
                        }
                    }
                },
                
                coastal: {
                    name: 'Coastal Culture',
                    emoji: 'üåä',
                    phonology: {
                        vowels: ['a', 'e', 'i', 'o', 'u', '…ô'],
                        consonants: ['p', 't', 'k', 'b', 'd', 'g', 'm', 'n', 's', 'z', ' É', ' í', 'l', 'r', 'w', 'j', 'h'],
                        syllableStructures: ['CV', 'CVC', 'V']
                    },
                    morphology: {
                        hasCases: true,
                        hasPlurals: true,
                        hasTenses: true,
                        hasGenders: false,
                        cases: ['nominative', 'accusative', 'genitive', 'allative'],
                        tenses: ['high-tide', 'low-tide', 'turning-tide'],
                        pluralTypes: ['suffix'],
                        genders: []
                    },
                    syntax: { wordOrder: 'vso' },
                    customAffixes: [
                        { name: 'seaward', morpheme: 'thal', type: 'prefix', category: 'derivational', description: 'Toward the sea' },
                        { name: 'landward', morpheme: 'ter', type: 'prefix', category: 'derivational', description: 'Toward the land' },
                        { name: 'deep-water', morpheme: 'dol', type: 'prefix', category: 'derivational', description: 'Related to deep ocean' }
                    ],
                    culturalData: {
                        type: 'coastal',
                        environment: 'coastal',
                        socialStructure: 'maritime-collective',
                        calendar: {
                            name: 'Tidal Rhythm Calendar',
                            description: 'Based on tidal cycles and seasonal fishing patterns',
                            timeConcept: 'cyclical with emphasis on tidal and seasonal ocean changes',
                            divisions: ['Storm-season', 'Calm-waters', 'Great-catch', 'Deep-currents', 'Shell-gathering'],
                            events: [
                                { name: 'Great Tide Turning', meaning: 'ceremony marking the highest tide of the year' },
                                { name: 'First Voyage Festival', meaning: 'celebration of young sailors first deep-sea journey' },
                                { name: 'Storm Calling Ritual', meaning: 'ritual to predict and prepare for sea storms' },
                                { name: 'Whale Song Night', meaning: 'evening of singing to honor the great sea creatures' }
                            ]
                        },
                        socialStructure: {
                            terms: [
                                { english: 'tide reader', meaning: 'tide interpreter', description: 'Elder who predicts tides and weather patterns' },
                                { english: 'fleet captain', meaning: 'deep-sea leader', description: 'Leader of fishing expeditions and naval operations' },
                                { english: 'shore keeper', meaning: 'land-sea guardian', description: 'Person responsible for maintaining coastal defenses' },
                                { english: 'pearl diver', meaning: 'deep seeker', description: 'Specialized diver who harvests pearls and sea treasures' },
                                { english: 'ship singer', meaning: 'sea-song keeper', description: 'Navigator who uses songs to remember sea routes' }
                            ]
                        },
                        traditions: {
                            life: [
                                { name: 'Sea Blessing Birth', description: 'Newborns blessed with seawater under the full moon' },
                                { name: 'Deep Water Trial', description: 'Coming-of-age ritual requiring deep ocean diving' }
                            ],
                            seasonal: [
                                { name: 'Storm Season Preparation', description: 'Community-wide preparation for dangerous storm season' },
                                { name: 'Calm Waters Celebration', description: 'Festival celebrating the arrival of calm sailing season' }
                            ],
                            social: [
                                { name: 'Crew Bonding Ceremony', description: 'Ritual creating sacred bonds between ship crew members' },
                                { name: 'Harbor Market Day', description: 'Weekly trading gathering where boats share their catch' }
                            ]
                        }
                    }
                },

                forest: {
                    name: 'Forest Culture',
                    emoji: 'üå≤',
                    phonology: {
                        vowels: ['a', 'e', 'i', 'o', 'u', '…ô'],
                        consonants: ['p', 't', 'k', 'b', 'd', 'g', 'm', 'n', '≈ã', 's', ' É', 'l', 'r', 'w', 'j'],
                        syllableStructures: ['CV', 'CVC', 'V']
                    },
                    morphology: {
                        hasCases: true,
                        hasPlurals: true,
                        hasTenses: true,
                        hasGenders: false,
                        cases: ['nominative', 'accusative', 'genitive', 'inessive'],
                        tenses: ['spring', 'summer', 'autumn', 'winter'],
                        pluralTypes: ['suffix'],
                        genders: []
                    },
                    syntax: { wordOrder: 'sov' },
                    customAffixes: [
                        { name: 'young-tree', morpheme: 'sil', type: 'prefix', category: 'derivational', description: 'Young or small trees/plants' },
                        { name: 'old-tree', morpheme: 'vor', type: 'prefix', category: 'derivational', description: 'Ancient or large trees' },
                        { name: 'canopy', morpheme: 'yel', type: 'prefix', category: 'derivational', description: 'Things in the tree canopy' }
                    ],
                    culturalData: {
                        type: 'forest',
                        environment: 'forest',
                        socialStructure: 'grove-council',
                        calendar: {
                            name: 'Growth Spiral Calendar',
                            description: 'Based on tree growth rings and seasonal forest changes',
                            timeConcept: 'spiral with emphasis on natural growth cycles',
                            divisions: ['Bud-time', 'Leaf-time', 'Flower-time', 'Fruit-time', 'Sleep-time'],
                            events: [
                                { name: 'First Leaf Ceremony', meaning: 'celebration of the first spring buds opening' },
                                { name: 'Great Harvest Festival', meaning: 'autumn gathering of forest fruits and nuts' },
                                { name: 'Tree Speaking Ritual', meaning: 'ceremony where elders commune with ancient trees' },
                                { name: 'Canopy Dance', meaning: 'summer celebration performed in the treetops' }
                            ]
                        },
                        socialStructure: {
                            terms: [
                                { english: 'grove keeper', meaning: 'ancient tree guardian', description: 'Elder responsible for protecting sacred groves' },
                                { english: 'path walker', meaning: 'forest guide', description: 'Scout who knows all forest paths and animal trails' },
                                { english: 'leaf reader', meaning: 'nature interpreter', description: 'Shaman who reads omens in leaf patterns' },
                                { english: 'beast friend', meaning: 'animal speaker', description: 'Person with special ability to communicate with forest animals' },
                                { english: 'root delver', meaning: 'earth seeker', description: 'Herbalist who knows underground root networks' }
                            ]
                        },
                        traditions: {
                            life: [
                                { name: 'Tree Naming Ceremony', description: 'Each child receives a tree that grows with them through life' },
                                { name: 'First Canopy Climb', description: 'Coming-of-age trial requiring climbing to the forest canopy' }
                            ],
                            seasonal: [
                                { name: 'Sap Gathering Time', description: 'Spring tradition of collecting tree sap for sacred ceremonies' },
                                { name: 'Autumn Leaf Burning', description: 'Ceremony burning fallen leaves to ensure forest renewal' }
                            ],
                            social: [
                                { name: 'Grove Council Meeting', description: 'Democratic decision-making held in sacred forest clearings' },
                                { name: 'Forest Gift Sharing', description: 'Tradition of sharing forest resources among all community members' }
                            ]
                        }
                    }
                },

                desert: {
                    name: 'Desert Culture',
                    emoji: 'üèúÔ∏è',
                    phonology: {
                        vowels: ['a', 'i', 'u'],
                        consonants: ['p', 't', 'k', 'q', 'b', 'd', 'g', ' î', 'm', 'n', 's', ' É', 'x', 'ƒß', ' ï', 'l', 'r', 'w', 'j'],
                        syllableStructures: ['CV', 'CVC', 'CVCC']
                    },
                    morphology: {
                        hasCases: true,
                        hasPlurals: true,
                        hasTenses: true,
                        hasGenders: false,
                        cases: ['nominative', 'accusative', 'genitive', 'ablative'],
                        tenses: ['past', 'present', 'future'],
                        pluralTypes: ['internal', 'suffix'],
                        genders: []
                    },
                    syntax: { wordOrder: 'vos' },
                    customAffixes: [
                        { name: 'water-blessed', morpheme: 'qad', type: 'prefix', category: 'derivational', description: 'Things with water or blessed' },
                        { name: 'dry-cursed', morpheme: 'har', type: 'prefix', category: 'derivational', description: 'Things without water or cursed' },
                        { name: 'kinship', morpheme: 'ibn', type: 'suffix', category: 'derivational', description: 'Family relationship marker' }
                    ],
                    culturalData: {
                        type: 'desert',
                        environment: 'desert',
                        socialStructure: 'nomadic-tribal',
                        calendar: {
                            name: 'Star-Sand Calendar',
                            description: 'Based on star positions and seasonal sandstorm patterns',
                            timeConcept: 'cyclical with emphasis on celestial navigation and weather patterns',
                            divisions: ['Star-clear', 'Sand-storm', 'Heat-peak', 'Cool-winds', 'Rain-hope'],
                            events: [
                                { name: 'Great Star Reading', meaning: 'ceremony for reading the year ahead in star patterns' },
                                { name: 'Oasis Blessing Festival', meaning: 'celebration honoring the life-giving oases' },
                                { name: 'Sandstorm Shelter Ritual', meaning: 'preparation ritual before major sandstorm season' },
                                { name: 'Great Kinship Gathering', meaning: 'annual meeting of all nomadic tribes at sacred oasis' }
                            ]
                        },
                        socialStructure: {
                            terms: [
                                { english: 'water finder', meaning: 'blessed seeker', description: 'Specialist who can locate water sources in the desert' },
                                { english: 'star navigator', meaning: 'star blessed', description: 'Expert who guides caravans using celestial navigation' },
                                { english: 'sand prophet', meaning: 'dry seer', description: 'Shaman who reads omens in sand patterns and wind direction' },
                                { english: 'tribe mother', meaning: 'kinship keeper', description: 'Elder woman who maintains tribal genealogies and water rights' },
                                { english: 'storm rider', meaning: 'wind rider', description: 'Warrior specialized in traveling during sandstorms' }
                            ]
                        },
                        traditions: {
                            life: [
                                { name: 'Water Naming Ceremony', description: 'Children named based on the water source where they were born' },
                                { name: 'Desert Walking Trial', description: 'Coming-of-age journey across dangerous desert alone' }
                            ],
                            seasonal: [
                                { name: 'Star Festival', description: 'Celebration during clearest nights for navigation training' },
                                { name: 'Rain Dancing', description: 'Ritual dancing to call the rare desert rains' }
                            ],
                            social: [
                                { name: 'Oasis Sharing Law', description: 'Sacred rule that all tribes must share oasis water' },
                                { name: 'Caravan Protection Duty', description: 'Obligation to protect and guide lost travelers' }
                            ]
                        }
                    }
                },

                plains: {
                    name: 'Plains Culture',
                    emoji: 'üåæ',
                    phonology: {
                        vowels: ['a', 'e', 'i', 'o', 'u', '…ë'],
                        consonants: ['p', 't', 'k', 'b', 'd', 'g', 'm', 'n', 's', 'l', 'r', 'w', 'j', 'h'],
                        syllableStructures: ['CV', 'CVC', 'V']
                    },
                    morphology: {
                        hasCases: true,
                        hasPlurals: true,
                        hasTenses: true,
                        hasGenders: false,
                        cases: ['nominative', 'accusative', 'genitive', 'locative'],
                        tenses: ['past', 'present', 'future'],
                        pluralTypes: ['suffix'],
                        genders: []
                    },
                    syntax: { wordOrder: 'svo' },
                    customAffixes: [
                        { name: 'near-distance', morpheme: 'vel', type: 'prefix', category: 'derivational', description: 'Things that are near' },
                        { name: 'far-distance', morpheme: 'kol', type: 'prefix', category: 'derivational', description: 'Things that are far away' },
                        { name: 'herd-collective', morpheme: 'gan', type: 'suffix', category: 'derivational', description: 'Collective or herd marker' }
                    ],
                    culturalData: {
                        type: 'plains',
                        environment: 'plains',
                        socialStructure: 'nomadic-herders',
                        calendar: {
                            name: 'Wind-Grass Calendar',
                            description: 'Based on wind patterns and grass growth cycles',
                            timeConcept: 'cyclical with emphasis on seasonal migrations and weather patterns',
                            divisions: ['Wind-turning', 'Grass-growing', 'Herd-moving', 'Storm-season', 'Rest-time'],
                            events: [
                                { name: 'Great Migration Festival', meaning: 'celebration marking the start of seasonal migration' },
                                { name: 'Wind Reading Ceremony', meaning: 'ritual to predict weather and choose migration routes' },
                                { name: 'Herd Blessing Day', meaning: 'ceremony to protect animals from predators and disease' },
                                { name: 'Grass Singing Night', meaning: 'evening celebration honoring the grasslands' }
                            ]
                        },
                        socialStructure: {
                            terms: [
                                { english: 'wind reader', meaning: 'weather interpreter', description: 'Elder who predicts weather patterns for migration' },
                                { english: 'herd master', meaning: 'animal leader', description: 'Expert in managing large herds of livestock' },
                                { english: 'path finder', meaning: 'route seeker', description: 'Scout who finds safe migration routes across the plains' },
                                { english: 'grass keeper', meaning: 'land tender', description: 'Person responsible for managing grazing areas' },
                                { english: 'storm rider', meaning: 'weather warrior', description: 'Brave rider who can travel during dangerous storms' }
                            ]
                        },
                        traditions: {
                            life: [
                                { name: 'Wind Name Giving', description: 'Children named after the wind direction on their birth day' },
                                { name: 'First Ride Trial', description: 'Coming-of-age test requiring solo journey across dangerous plains' }
                            ],
                            seasonal: [
                                { name: 'Migration Preparation', description: 'Community ritual before the great seasonal migration' },
                                { name: 'Grass Growth Celebration', description: 'Festival celebrating the renewal of grasslands' }
                            ],
                            social: [
                                { name: 'Herd Sharing Law', description: 'Sacred rule that all families share grazing rights' },
                                { name: 'Traveler Aid Duty', description: 'Obligation to help lost travelers find their way' }
                            ]
                        }
                    }
                },

                arctic: {
                    name: 'Arctic Culture',
                    emoji: '‚ùÑÔ∏è',
                    phonology: {
                        vowels: ['a', 'i', 'u'],
                        consonants: ['p', 't', 'k', 'q', 'b', 'd', 'g', 'm', 'n', '≈ã', 's', ' É', 'l', 'r', 'w', 'j', 'h'],
                        syllableStructures: ['CV', 'CVC', 'CVCC']
                    },
                    morphology: {
                        hasCases: true,
                        hasPlurals: true,
                        hasTenses: true,
                        hasGenders: false,
                        cases: ['nominative', 'accusative', 'genitive', 'instrumental'],
                        tenses: ['cold-season', 'warm-season', 'changing-season'],
                        pluralTypes: ['suffix'],
                        genders: []
                    },
                    syntax: { wordOrder: 'sov' },
                    customAffixes: [
                        { name: 'ice-cold', morpheme: 'nul', type: 'prefix', category: 'derivational', description: 'Things related to ice and extreme cold' },
                        { name: 'warm-life', morpheme: 'vil', type: 'prefix', category: 'derivational', description: 'Things that provide warmth or life' },
                        { name: 'survival', morpheme: 'kuk', type: 'suffix', category: 'derivational', description: 'Things necessary for survival' }
                    ],
                    culturalData: {
                        type: 'arctic',
                        environment: 'arctic',
                        socialStructure: 'family-clans',
                        calendar: {
                            name: 'Ice-Sun Calendar',
                            description: 'Based on ice formation patterns and sun visibility',
                            timeConcept: 'cyclical with emphasis on light and dark seasons',
                            divisions: ['Deep-dark', 'Light-returning', 'Ice-breaking', 'Short-warm', 'Ice-forming'],
                            events: [
                                { name: 'First Light Festival', meaning: 'celebration of the sun returning after dark season' },
                                { name: 'Ice Breaking Ceremony', meaning: 'ritual marking the end of the hardest cold' },
                                { name: 'Survival Sharing Day', meaning: 'community event for sharing resources and skills' },
                                { name: 'Long Dark Preparation', meaning: 'ceremony preparing for the season without sun' }
                            ]
                        },
                        socialStructure: {
                            terms: [
                                { english: 'ice reader', meaning: 'cold interpreter', description: 'Elder who can predict ice conditions and weather' },
                                { english: 'hunt leader', meaning: 'prey finder', description: 'Expert hunter who leads group hunts for survival' },
                                { english: 'warmth keeper', meaning: 'life preserver', description: 'Person responsible for maintaining fires and shelter' },
                                { english: 'story keeper', meaning: 'memory holder', description: 'Elder who remembers important survival knowledge' },
                                { english: 'seal friend', meaning: 'ice hunter', description: 'Specialist in hunting seals and ice fishing' }
                            ]
                        },
                        traditions: {
                            life: [
                                { name: 'Ice Name Ceremony', description: 'Children named based on ice patterns when they were born' },
                                { name: 'Survival Test Trial', description: 'Coming-of-age test requiring surviving alone in the cold' }
                            ],
                            seasonal: [
                                { name: 'Light Return Celebration', description: 'Festival celebrating the return of the sun' },
                                { name: 'Ice Breaking Feast', description: 'Community meal when the ice begins to melt' }
                            ],
                            social: [
                                { name: 'Warmth Sharing Rule', description: 'Sacred obligation to share warmth and shelter' },
                                { name: 'Hunt Result Sharing', description: 'Traditional sharing of all hunting results with community' }
                            ]
                        }
                    }
                },

                island: {
                    name: 'Island Culture',
                    emoji: 'üèùÔ∏è',
                    phonology: {
                        vowels: ['a', 'e', 'i', 'o', 'u'],
                        consonants: ['p', 't', 'k', 'b', 'd', 'g', 'm', 'n', 's', 'l', 'r', 'w', 'j', 'h'],
                        syllableStructures: ['CV', 'V', 'CVC']
                    },
                    morphology: {
                        hasCases: true,
                        hasPlurals: true,
                        hasTenses: true,
                        hasGenders: false,
                        cases: ['nominative', 'accusative', 'genitive'],
                        tenses: ['past', 'present', 'future'],
                        pluralTypes: ['suffix'],
                        genders: []
                    },
                    syntax: { wordOrder: 'vso' },
                    customAffixes: [
                        { name: 'wind-north', morpheme: 'nau', type: 'prefix', category: 'derivational', description: 'North wind direction' },
                        { name: 'wind-south', morpheme: 'roa', type: 'prefix', category: 'derivational', description: 'South wind direction' },
                        { name: 'coral-type', morpheme: 'lani', type: 'suffix', category: 'derivational', description: 'Type of coral or reef structure' }
                    ],
                    culturalData: {
                        type: 'island',
                        environment: 'island',
                        socialStructure: 'island-council',
                        calendar: {
                            name: 'Wave-Wind Calendar',
                            description: 'Based on wave patterns and wind directions',
                            timeConcept: 'cyclical with emphasis on ocean patterns and weather',
                            divisions: ['Calm-waters', 'Strong-winds', 'Storm-season', 'Fish-running', 'Coral-spawning'],
                            events: [
                                { name: 'Wave Dance Festival', meaning: 'celebration honoring the ocean and its gifts' },
                                { name: 'Wind Navigation Ceremony', meaning: 'ritual teaching young people to read wind patterns' },
                                { name: 'Coral Blessing Day', meaning: 'ceremony to protect and honor the coral reefs' },
                                { name: 'Island Unity Gathering', meaning: 'meeting where all island families come together' }
                            ]
                        },
                        socialStructure: {
                            terms: [
                                { english: 'wave reader', meaning: 'ocean interpreter', description: 'Elder who can predict ocean conditions' },
                                { english: 'coral keeper', meaning: 'reef guardian', description: 'Person responsible for protecting coral reefs' },
                                { english: 'wind singer', meaning: 'navigation guide', description: 'Expert who uses songs to navigate by wind' },
                                { english: 'fish caller', meaning: 'sea hunter', description: 'Specialist in finding and catching fish' },
                                { english: 'island speaker', meaning: 'council voice', description: 'Representative who speaks for the island community' }
                            ]
                        },
                        traditions: {
                            life: [
                                { name: 'Ocean Blessing Birth', description: 'Newborns blessed with ocean water under open sky' },
                                { name: 'Deep Sea Trial', description: 'Coming-of-age test requiring swimming to the deep ocean' }
                            ],
                            seasonal: [
                                { name: 'Coral Spawning Watch', description: 'Community observation of annual coral reproduction' },
                                { name: 'Storm Shelter Preparation', description: 'Seasonal preparation for protecting the island' }
                            ],
                            social: [
                                { name: 'Reef Protection Law', description: 'Sacred rule forbidding damage to coral reefs' },
                                { name: 'Visitor Welcome Duty', description: 'Traditional obligation to welcome ocean travelers' }
                            ]
                        }
                    }
                },

                urban: {
                    name: 'Urban Culture',
                    emoji: 'üèôÔ∏è',
                    phonology: {
                        vowels: ['a', 'e', 'i', 'o', 'u', '…ô', '…õ'],
                        consonants: ['p', 't', 'k', 'b', 'd', 'g', 'f', 'v', 's', 'z', ' É', ' í', 'm', 'n', 'l', 'r', 'w', 'j', 'h'],
                        syllableStructures: ['CV', 'CVC', 'CCV']
                    },
                    morphology: {
                        hasCases: true,
                        hasPlurals: true,
                        hasTenses: true,
                        hasGenders: true,
                        cases: ['nominative', 'accusative', 'genitive', 'dative'],
                        tenses: ['past', 'present', 'future', 'perfect'],
                        pluralTypes: ['suffix'],
                        genders: ['formal', 'informal']
                    },
                    syntax: { wordOrder: 'svo' },
                    customAffixes: [
                        { name: 'high-status', morpheme: 'plex', type: 'prefix', category: 'derivational', description: 'High social status marker' },
                        { name: 'low-status', morpheme: 'min', type: 'prefix', category: 'derivational', description: 'Low social status marker' },
                        { name: 'tech-new', morpheme: 'neo', type: 'prefix', category: 'derivational', description: 'New technology or innovation' }
                    ],
                    culturalData: {
                        type: 'urban',
                        environment: 'urban',
                        socialStructure: 'hierarchical-bureaucratic',
                        calendar: {
                            name: 'Clock-Tower Calendar',
                            description: 'Based on precise timekeeping and industrial schedules',
                            timeConcept: 'linear with emphasis on efficiency and productivity',
                            divisions: ['Work-season', 'Trade-season', 'Innovation-time', 'Celebration-time', 'Planning-time'],
                            events: [
                                { name: 'Innovation Fair', meaning: 'celebration of new technologies and ideas' },
                                { name: 'Trade Guild Festival', meaning: 'gathering of all professional guilds and merchants' },
                                { name: 'City Founding Day', meaning: 'commemoration of the city establishment' },
                                { name: 'Social Harmony Ceremony', meaning: 'ritual promoting cooperation between social classes' }
                            ]
                        },
                        socialStructure: {
                            terms: [
                                { english: 'guild master', meaning: 'craft leader', description: 'Head of a professional trade guild' },
                                { english: 'district speaker', meaning: 'area representative', description: 'Elected representative of a city district' },
                                { english: 'market keeper', meaning: 'trade guardian', description: 'Official responsible for fair trade and commerce' },
                                { english: 'tech innovator', meaning: 'new creator', description: 'Person who develops new technologies and methods' },
                                { english: 'social mediator', meaning: 'peace maker', description: 'Professional who resolves conflicts between groups' }
                            ]
                        },
                        traditions: {
                            life: [
                                { name: 'Guild Apprentice Ceremony', description: 'Formal induction into professional training' },
                                { name: 'Citizen Recognition Trial', description: 'Coming-of-age test for full city citizenship rights' }
                            ],
                            seasonal: [
                                { name: 'Innovation Showcase', description: 'Annual display of new inventions and improvements' },
                                { name: 'Social Unity Festival', description: 'Celebration bringing together all social classes' }
                            ],
                            social: [
                                { name: 'Fair Trade Agreement', description: 'Sacred commercial code ensuring honest business' },
                                { name: 'Citizen Aid Obligation', description: 'Duty to help fellow citizens in need' }
                            ]
                        }
                    }
                }
            };

            const preset = culturalPresets[culture];
            if (!preset) {
                showToast('Cultural preset not found!', 'error');
                return;
            }

            console.log(`Loading ${preset.name} sample language...`);
            showToast(`Generating ${preset.name} language... Please wait.`, 'success');
            closeSampleModal();

            // COMPLETELY RESET THE LANGUAGE SYSTEM
            window.generator.language = {
                name: preset.name,
                phonology: JSON.parse(JSON.stringify(preset.phonology)),
                morphology: JSON.parse(JSON.stringify(preset.morphology)),
                syntax: JSON.parse(JSON.stringify(preset.syntax)),
                culture: JSON.parse(JSON.stringify(preset.culturalData)),
                customWords: [],
                customAffixes: JSON.parse(JSON.stringify(preset.customAffixes))
            };

            // Clear existing state
            window.appState.setState('allWords', []);
            
            // Generate syllables from phonology
            window.generator.language.phonology.syllables = [];
            for (let structure of preset.phonology.syllableStructures) {
                for (let i = 0; i < 30; i++) {
                    let syllable = '';
                    for (let char of structure) {
                        if (char === 'C') {
                            syllable += window.generator.randomChoice(preset.phonology.consonants);
                        } else if (char === 'V') {
                            syllable += window.generator.randomChoice(preset.phonology.vowels);
                        }
                    }
                    if (!window.generator.language.phonology.syllables.includes(syllable)) {
                        window.generator.language.phonology.syllables.push(syllable);
                    }
                }
            }

            // Generate core vocabulary using existing system
            window.generator.generateVocabulary();
            
            // GENERATE AND ADD CULTURAL TERMS TO DICTIONARY
            setTimeout(() => {
                const culturalWords = [];
                
                // Generate calendar event words
                if (preset.culturalData.calendar && preset.culturalData.calendar.events) {
                    preset.culturalData.calendar.events.forEach(event => {
                        const dynamicWord = window.generator.generateWord();
                        culturalWords.push({
                            conlang: dynamicWord,
                            english: event.name.toLowerCase(),
                            pos: 'noun',
                            type: 'cultural-event',
                            notes: event.meaning,
                            dateAdded: new Date().toLocaleDateString()
                        });
                    });
                }
                
                // Generate social structure term words
                if (preset.culturalData.socialStructure && preset.culturalData.socialStructure.terms) {
                    preset.culturalData.socialStructure.terms.forEach(term => {
                        const dynamicWord = window.generator.generateWord();
                        culturalWords.push({
                            conlang: dynamicWord,
                            english: term.english,
                            pos: 'noun',
                            type: 'social-role',
                            notes: `${term.meaning} - ${term.description}`,
                            dateAdded: new Date().toLocaleDateString()
                        });
                    });
                }
                
                // Generate tradition words
                if (preset.culturalData.traditions) {
                    Object.entries(preset.culturalData.traditions).forEach(([category, traditions]) => {
                        traditions.forEach(tradition => {
                            const dynamicWord = window.generator.generateWord();
                            culturalWords.push({
                                conlang: dynamicWord,
                                english: tradition.name.toLowerCase().replace(/\s+/g, ' '),
                                pos: 'noun',
                                type: `cultural-${category}`,
                                notes: tradition.description,
                                dateAdded: new Date().toLocaleDateString()
                            });
                        });
                    });
                }
                
                // Add all cultural words to the language system
                window.generator.language.customWords.push(...culturalWords);
                culturalWords.forEach(word => window.appState.addWord(word));
                
                // Generate cultural data for CulturalModule with dynamic words
                if (window.CulturalModule) {
                    // Calendar terms
                    const calendarTerms = {};
                    if (preset.culturalData.calendar && preset.culturalData.calendar.events) {
                        preset.culturalData.calendar.events.forEach((event, index) => {
                            const matchingWord = culturalWords.find(w => w.english === event.name.toLowerCase());
                            calendarTerms[event.name.toLowerCase().replace(/\s+/g, '-')] = {
                                name: event.name,
                                conlangName: matchingWord ? matchingWord.conlang : window.generator.generateWord(),
                                meaning: event.meaning
                            };
                        });
                    }
                    
                    // Social terms
                    const socialTerms = {};
                    if (preset.culturalData.socialStructure && preset.culturalData.socialStructure.terms) {
                        preset.culturalData.socialStructure.terms.forEach(term => {
                            const matchingWord = culturalWords.find(w => w.english === term.english);
                            socialTerms[term.english.toLowerCase().replace(/\s+/g, '-')] = {
                                word: matchingWord ? matchingWord.conlang : window.generator.generateWord(),
                                meaning: term.meaning,
                                description: term.description,
                                category: 'social-role',
                                importance: 'Important social concept'
                            };
                        });
                    }
                    
                    // Tradition terms
                    const traditionTerms = {};
                    if (preset.culturalData.traditions) {
                        Object.entries(preset.culturalData.traditions).forEach(([category, traditions]) => {
                            traditionTerms[category] = {};
                            traditions.forEach(tradition => {
                                const matchingWord = culturalWords.find(w => w.english === tradition.name.toLowerCase());
                                traditionTerms[category][tradition.name.toLowerCase().replace(/\s+/g, '-')] = {
                                    name: tradition.name,
                                    conlangName: matchingWord ? matchingWord.conlang : window.generator.generateWord(),
                                    description: tradition.description,
                                    category: category
                                };
                            });
                        });
                    }
                    
                    // Store in CulturalModule
                    window.CulturalModule.generatedCalendarTerms = calendarTerms;
                    window.CulturalModule.generatedSocialTerms = socialTerms;
                    window.CulturalModule.generatedTraditions = traditionTerms;
                    window.CulturalModule.currentCulture = preset.culturalData;
                    
                    console.log('Generated cultural data:', {
                        calendar: Object.keys(calendarTerms).length,
                        social: Object.keys(socialTerms).length,
                        traditions: Object.values(traditionTerms).reduce((sum, cat) => sum + Object.keys(cat).length, 0),
                        totalCulturalWords: culturalWords.length
                    });
                }
                
                // UPDATE ALL UI ELEMENTS AND STATES
                
                // Generate and update phonology system
                if (window.PhonologyModule) {
                    // Set phonology form values
                    const vowelSelect = document.getElementById('vowel-set');
                    const consonantSelect = document.getElementById('consonant-set');
                    const environmentSelect = document.getElementById('environment');
                    
                    if (vowelSelect) vowelSelect.value = 'standard';
                    if (consonantSelect) consonantSelect.value = 'standard';
                    if (environmentSelect) environmentSelect.value = culture;
                    
                    // ACTUALLY DISPLAY the phonology that was already set
                    window.PhonologyModule.displayPhonology(window.generator.language.phonology);
                    
                    // Show phonology results section
                    const phonologySection = document.getElementById('phonology-results');
                    if (phonologySection) phonologySection.style.display = 'block';
                }
                
                // Generate morphological affixes from the preset data
                if (!window.generator.language.morphology.affixes) {
                    window.generator.language.morphology.affixes = {};
                }
                
                // Generate affixes for cases
                if (preset.morphology.cases && preset.morphology.cases.length > 0) {
                    preset.morphology.cases.forEach(caseType => {
                        const affix = window.generator.generateAffix();
                        affix.originalCategory = 'case';
                        affix.description = `Case marker for ${caseType}`;
                        window.generator.language.morphology.affixes[caseType] = affix;
                    });
                }
                
                // Generate affixes for tenses
                if (preset.morphology.tenses && preset.morphology.tenses.length > 0) {
                    preset.morphology.tenses.forEach(tense => {
                        const affix = window.generator.generateAffix();
                        affix.originalCategory = 'tense';
                        affix.description = `Tense marker for ${tense}`;
                        window.generator.language.morphology.affixes[tense] = affix;
                    });
                }
                
                // Generate affixes for genders
                if (preset.morphology.genders && preset.morphology.genders.length > 0) {
                    preset.morphology.genders.forEach(gender => {
                        const affix = window.generator.generateAffix();
                        affix.originalCategory = 'gender';
                        affix.description = `Gender marker for ${gender}`;
                        window.generator.language.morphology.affixes[gender] = affix;
                    });
                }
                
                // Generate affixes for plurals
                if (preset.morphology.pluralTypes && preset.morphology.pluralTypes.length > 0) {
                    preset.morphology.pluralTypes.forEach(type => {
                        const affix = window.generator.generateAffix(type);
                        affix.originalCategory = 'number';
                        affix.description = `Plural formation via ${type}`;
                        window.generator.language.morphology.affixes[`plural-${type}`] = affix;
                    });
                }
                
                // Update morphology UI and display
                if (window.MorphologyModule) {
                    // Set morphology form values
                    const wordOrderSelect = document.getElementById('word-order');
                    if (wordOrderSelect) wordOrderSelect.value = preset.syntax.wordOrder;
                    
                    // Set feature checkboxes
                    const featureCheckboxes = {
                        'has-cases': preset.morphology.hasCases,
                        'has-plurals': preset.morphology.hasPlurals,
                        'has-tenses': preset.morphology.hasTenses,
                        'has-genders': preset.morphology.hasGenders
                    };
                    
                    Object.entries(featureCheckboxes).forEach(([id, checked]) => {
                        const checkbox = document.getElementById(id);
                        if (checkbox) checkbox.checked = checked;
                    });
                    
                    // Clear existing case/tense checkboxes first
                    const allCaseCheckboxes = document.querySelectorAll('[id^="case-"]');
                    allCaseCheckboxes.forEach(cb => cb.checked = false);
                    const allTenseCheckboxes = document.querySelectorAll('[id^="tense-"]');
                    allTenseCheckboxes.forEach(cb => cb.checked = false);
                    const allGenderCheckboxes = document.querySelectorAll('[id^="gender-"]');
                    allGenderCheckboxes.forEach(cb => cb.checked = false);
                    
                    // Set case checkboxes
                    if (preset.morphology.cases) {
                        preset.morphology.cases.forEach(caseType => {
                            const checkbox = document.getElementById(`case-${caseType}`);
                            if (checkbox) checkbox.checked = true;
                        });
                    }
                    
                    // Set tense checkboxes
                    if (preset.morphology.tenses) {
                        preset.morphology.tenses.forEach(tense => {
                            const checkbox = document.getElementById(`tense-${tense}`);
                            if (checkbox) checkbox.checked = true;
                        });
                    }
                    
                    // Set gender checkboxes
                    if (preset.morphology.genders) {
                        preset.morphology.genders.forEach(gender => {
                            const checkbox = document.getElementById(`gender-${gender}`);
                            if (checkbox) checkbox.checked = true;
                        });
                    }
                    
                    // Update morphology displays
                    window.MorphologyModule.displayMorphology();
                    window.MorphologyModule.updateAffixDropdowns();
                    
                    // Show morphology results
                    const morphologySection = document.getElementById('morphology-results');
                    if (morphologySection) morphologySection.style.display = 'block';
                }
                
                // Generate and display grammar rules
                if (window.GrammarModule) {
                    // Generate grammar rules based on the morphology and syntax
                    if (window.GrammarModule.generateGrammarRules) {
                        const grammarRules = window.GrammarModule.generateGrammarRules();
                        window.generator.language.grammarRules = grammarRules;
                        
                        // Display grammar rules
                        if (window.GrammarModule.displayGrammarRules) {
                            window.GrammarModule.displayGrammarRules(grammarRules);
                        }
                        
                        // Show grammar results
                        const grammarSection = document.getElementById('grammar-results');
                        if (grammarSection) grammarSection.style.display = 'block';
                    }
                }
                
                // Update cultural UI
                if (window.CulturalModule) {
                    // Set cultural form values
                    const cultureTypeSelect = document.getElementById('culture-type');
                    const socialStructureSelect = document.getElementById('social-structure');
                    
                    if (cultureTypeSelect) cultureTypeSelect.value = preset.culturalData.type;
                    if (socialStructureSelect) socialStructureSelect.value = preset.culturalData.socialStructure;
                    
                    // Display the generated cultural content
                    if (window.CulturalModule.displayCalendar) {
                        window.CulturalModule.displayCalendar(preset.culturalData.calendar);
                    }
                }
                
                // Mark systems as user-set to prevent override
                if (window.generator.userSet) {
                    window.generator.userSet.phonology = true;
                    window.generator.userSet.morphology = true;
                    window.generator.userSet.grammar = true;
                }
                
                // Update all module displays with delay to ensure everything is loaded
                const modulesToUpdate = [
                    'VocabularyModule',
                    'OverviewModule', 
                    'ActivityModule',
                    'PhonologyModule',
                    'MorphologyModule'
                ];
                
                modulesToUpdate.forEach(moduleName => {
                    if (window[moduleName] && window[moduleName].updateDisplay) {
                        window[moduleName].updateDisplay();
                    }
                    if (window[moduleName] && window[moduleName].updateOverview) {
                        window[moduleName].updateOverview();
                    }
                });
                
                // Force overview update to show completed systems
                if (window.OverviewModule) {
                    setTimeout(() => {
                        window.OverviewModule.updateOverview();
                        window.OverviewModule.checkCompleteness();
                    }, 200);
                }
                
                // Switch to overview tab to show results
                if (window.switchTab) {
                    window.switchTab('overview');
                }
                
                // Add activity
                if (window.ActivityModule) {
                    window.ActivityModule.addActivity(`Loaded ${preset.name} preset with ${culturalWords.length} cultural terms`, 'preset');
                }
                
                const totalWords = window.appState.getState('allWords').length;
                showToast(`${preset.name} generated! ${totalWords} words including ${culturalWords.length} cultural terms.`, 'success');
                
            }, 1000); // Give time for core vocabulary to generate
        }

        // Modal Utilities - Add this to index.html or create as separate file

// Click outside modal to close
document.addEventListener('DOMContentLoaded', function() {
    // Handle clicks outside modals
    window.onclick = function(event) {
        // Sample modal
        const sampleModal = document.getElementById('sample-modal');
        if (event.target === sampleModal) {
            closeSampleModal();
        }
        
        // Edit word modal
        const editWordModal = document.getElementById('edit-word-modal');
        if (event.target === editWordModal) {
            if (window.VocabularyModule) {
                window.VocabularyModule.closeModal('edit-word-modal');
            }
        }
        
        // Edit affix modal
        const editAffixModal = document.getElementById('edit-affix-modal');
        if (event.target === editAffixModal) {
            if (window.MorphologyModule) {
                window.MorphologyModule.closeModal('edit-affix-modal');
            }
        }
    };
    
        // Handle escape key to close modals
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const sampleModal = document.getElementById('sample-modal');
                const editWordModal = document.getElementById('edit-word-modal');
                const editAffixModal = document.getElementById('edit-affix-modal');
                
                if (sampleModal && sampleModal.style.display === 'block') {
                    closeSampleModal();
                }
                
                if (editWordModal && editWordModal.style.display === 'block') {
                    if (window.VocabularyModule) {
                        window.VocabularyModule.closeModal('edit-word-modal');
                    }
                }
                
                if (editAffixModal && editAffixModal.style.display === 'block') {
                    if (window.MorphologyModule) {
                        window.MorphologyModule.closeModal('edit-affix-modal');
                    }
                }
            }
        });
    });
    </script>
</body>
</html>